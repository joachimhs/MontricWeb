/*! Montric 30-09-2015 */
var Montric=Ember.Application.create({ready:function(){this.register("session:setting",Montric.SettingsController,{singleton:!0}),this.inject("controller:setting","store","store:main"),this.inject("controller","settings","session:setting")},createCookie:function(a,b,c){var d=null;if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toGMTString()}else d="";document.cookie=a+"="+b+d+"; path=/"},readCookie:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null},eraseCookie:function(a){this.createCookie(a,"",-1)}});Montric.ApplicationSerializer=DS.RESTSerializer.extend({}),Montric.RawTransform=DS.Transform.extend({deserialize:function(a){return a},serialize:function(a){return a}}),Montric.Adapter=DS.RESTAdapter.extend({defaultSerializer:"Montric/application"}),Montric.AdminAccessTokensAccessTokenController=Ember.ObjectController.extend({needs:["admin"],actions:{doCommitAccessToken:function(){console.log("doCommitAccessToken: "+this.get("model")),this.get("model")&&this.get("model").save()}}}),Montric.AdminAccessTokensController=Ember.ArrayController.extend({}),Montric.AdminAccessTokensRoute=Ember.Route.extend({model:function(){return this.store.find("accessToken")}}),Montric.AdminController=Ember.Controller.extend({needs:["application","adminAlerts","adminChartGroups","adminAccessTokens","adminAlertRecipients"],actions:{addNewAlert:function(){this.set("showNewAlertPanel",!0)},saveNewAlert:function(){{var a=this.get("newAlertName");this.store.createRecord("alert",{id:a})}this.set("newAlertName",""),this.set("showNewAlertPanel",!1)},cancelNewAlert:function(){this.set("newAlertName",""),this.set("showNewAlertPanel",!1)},addNewChartGroup:function(){this.set("showNewChartGroupPanel",!0)},saveNewChartGroup:function(){{var a=this.get("newChartGroupName");this.store.createRecord("chartGroup",{id:a})}this.set("newChartGroupName",""),this.set("showNewChartGroupPanel",!1)},cancelNewChartGroup:function(){this.set("newChartGroupName",""),this.set("showNewChartGroupPanel",!1)},addNewAccessToken:function(){this.set("showNewAccessTokenPanel",!0)},cancelNewAccessToken:function(){this.set("showNewAccessTokenPanel",!1),this.set("newAccessTokenName","")},saveNewAccessToken:function(){var a=this.get("newAccessTokenName"),b=this.store.createRecord("accessToken",{id:Math.uuid(16),accessTokenName:a});b.save(),this.set("newAccessTokenName",""),this.set("showNewAccessTokenPanel",!1)},addNewAlertRecipient:function(){this.set("showNewAlertRecipientPanel",!0)},cancelNewAlertRecipient:function(){this.set("showNewAlertRecipientPanel",!1),this.set("newAlertRecipientName","")},saveNewAlertRecipient:function(){var a=this.get("newAlertRecipientName"),b=this.store.createRecord("alertRecipient",{id:a});b.save(),this.set("newAlertRecipientName",""),this.set("showNewAlertRecipientPanel",!1)}},isAdminAlertsActive:function(){return this.get("controllers.application.currentPath").startsWith("main.admin.alerts")}.property("controllers.application.currentPath"),isAdminChartGroupsActive:function(){return this.get("controllers.application.currentPath").startsWith("main.admin.chartGroups")}.property("controllers.application.currentPath"),isAdminAccessTokensActive:function(){return this.get("controllers.application.currentPath").startsWith("main.admin.accessTokens")}.property("controllers.application.currentPath"),isAdminAlertRecipientsActive:function(){return this.get("controllers.application.currentPath").startsWith("main.admin.alertRecipients")}.property("controllers.application.currentPath"),contentIsLoadedObserver:function(){console.log("Metrics isLoaded: "+this.get("content.isLoaded"));var a=Ember.A();this.get("content.isLoaded")&&(console.log("Starting iteration over menu nodes"),this.get("content").forEach(function(b){b.get("parent.id")||a.pushObject(b)}),a.sort(Montric.Metric.compareNodes),console.log("Finished iterating over menu nodes. found "+a.get("length")+" root nodes")),this.set("rootNodes",a)}.observes("content.isLoaded").on("init"),isSelectedObserver:function(){if(this.get("content")){var a=this.get("content").filter(function(a){return a.get("isSelected")?!0:void 0});this.set("selectedNodes",a)}}.observes("content.@each.isSelected"),resetSelectedNodes:function(){console.log("resetSelectedNodes!!"),this.get("selectedNodes").forEach(function(a){a.set("isSelected",!1)})}}),Montric.AdminRoute=Ember.Route.extend({model:function(){return this.store.find("metric")}}),Montric.AdminAlertRecipientsAlertRecipientController=Ember.ObjectController.extend({needs:["admin"],selectedAlertRecipients:Ember.A(),actions:{doCommitAlertRecipient:function(){console.log("doCommitAccessToken: "+this.get("model")),this.get("model")&&this.get("alertRecipient").save()},addNewRecipient:function(){var a=this.get("newRecipient"),b=this.get("alertRecipient");b&&a&&(b.get("recipients").pushObject(a),this.set("newRecipient",null))},deleteSelectedNodes:function(){var a=this.get("alertRecipient");a&&this.get("selectedAlertRecipients").forEach(function(b){a.get("recipients").removeObject(b)})}}}),Montric.AdminAlertRecipientsAlertRecipientRoute=Ember.Route.extend({model:function(a){return Ember.RSVP.hash({alertRecipient:this.store.find("alertRecipient",a.alert_recipient_id),alertPlugins:this.store.find("alertPlugin")})}}),Montric.AdminAlertRecipientsController=Ember.ObjectController.extend({}),Montric.AdminAlertRecipientsRoute=Ember.Route.extend({model:function(){return Ember.RSVP.hash({alertRecipients:this.store.find("alertRecipient")})}}),Montric.AdminAlertsController=Ember.ArrayController.extend({}),Montric.AdminAlertsRoute=Ember.Route.extend({model:function(){return this.store.find("alert")}}),Montric.AdminAlertsAlertController=Ember.ObjectController.extend({needs:["admin"],actions:{doCommitAlert:function(){console.log("doCommitAlert: "+this.get("model")),this.get("model")&&this.get("model").save()}},alertTypes:[{key:"greater_than",value:"Greater than"},{key:"less_than",value:"Less than"},{key:"equals",value:"Equal to"}]}),Montric.AdminChartGroupsController=Ember.ArrayController.extend({}),Montric.AdminChartGroupsRoute=Ember.Route.extend({model:function(){return this.store.find("chartGroup")}}),Montric.AdminChartGroupsChartGroupController=Ember.ObjectController.extend({needs:["admin"],actions:{doAddCheckedNodes:function(){console.log("doAddCheckedNodes");var a=this.get("controllers.admin.selectedNodes"),b=this.get("model");b?a.forEach(function(a){var c=!0;b.get("chartGroups").forEach(function(b){console.log("existingGroup:"),console.log(b),b.get("id")===a.get("id")&&(c=!1)}),c&&b.get("chartGroups").pushObject(a)}):console.log("NO SELECTED CHART GROUP"),a.setEach("isSelected",!1)},doDeleteSelectedNodes:function(){var a=this.get("selectedChartGroups"),b=this.get("chartGroups");b.forEach(function(c){a.forEach(function(a){c.get("id")===a&&b.removeObject(c)})}),this.set("selectedChartGroups",Ember.A())},doCommitChartGroup:function(){this.get("model")&&this.get("model").save()}}}),Montric.ApplicationController=Ember.Controller.extend({needs:["explore","user"],timezones:null,selectedTimezone:null,chartTimespans:null,selectedChartTimespan:null,chartResolutions:null,selectedChartResolution:null,selectedChartFromString:null,selectedChartToString:null,selectedChartFrom:null,selectedChartTo:null,dateFormat:"dd mmmm yyyy HH:MM",showLiveCharts:null,init:function(){this._super(),this.get("controllers.user"),this.set("showLiveCharts",!0),this.set("timezones",[]),this.set("chartTimespans",[]),this.set("chartResolutions",[]),this.set("selectedChartTo",new Date);var a=new Date(this.get("selectedChartTo").getTime()-6e5);a&&this.set("selectedChartFrom",a),this.generateChartStrings(),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"-12",timezoneName:"UTC-12"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"-11",timezoneName:"UTC-11"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"-10",timezoneName:"UTC-10"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"-9",timezoneName:"UTC-9"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"-8",timezoneName:"UTC-8"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"-7",timezoneName:"UTC-7"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"-6",timezoneName:"UTC-6"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"-5",timezoneName:"UTC-5"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"-4",timezoneName:"UTC-4"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"-3",timezoneName:"UTC-3"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"-2",timezoneName:"UTC-2"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"-1",timezoneName:"UTC-1"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"0",timezoneName:"UTC0"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"1",timezoneName:"UTC+1"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"2",timezoneName:"UTC+2"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"3",timezoneName:"UTC+3"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"4",timezoneName:"UTC+4"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"5",timezoneName:"UTC+5"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"6",timezoneName:"UTC+6"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"7",timezoneName:"UTC+7"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"8",timezoneName:"UTC+8"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"9",timezoneName:"UTC+9"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"10",timezoneName:"UTC+10"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"11",timezoneName:"UTC+11"})),this.get("timezones").pushObject(Ember.Object.create({timezoneValue:"12",timezoneName:"UTC+12"}));var b=-1*(new Date).getTimezoneOffset()/60+12;this.set("selectedTimezone",this.get("timezones").objectAt(b)),this.get("chartTimespans").pushObject(Ember.Object.create({timespanName:"10 Minutes",timespanValue:"10"})),this.get("chartTimespans").pushObject(Ember.Object.create({timespanName:"20 Minutes",timespanValue:"20"})),this.get("chartTimespans").pushObject(Ember.Object.create({timespanName:"30 Minutes",timespanValue:"30"})),this.get("chartTimespans").pushObject(Ember.Object.create({timespanName:"1 hour",timespanValue:"60"})),this.get("chartTimespans").pushObject(Ember.Object.create({timespanName:"2 hours",timespanValue:"120"})),this.get("chartTimespans").pushObject(Ember.Object.create({timespanName:"6 hours",timespanValue:"360"})),this.get("chartTimespans").pushObject(Ember.Object.create({timespanName:"12 hours",timespanValue:"720"})),this.get("chartTimespans").pushObject(Ember.Object.create({timespanName:"24 hours",timespanValue:"1440"})),this.set("selectedChartTimespan",this.get("chartTimespans").objectAt(0)),this.get("chartResolutions").pushObject(Ember.Object.create({chartResolutionName:"15 seconds",chartResolutionValue:"15"})),this.get("chartResolutions").pushObject(Ember.Object.create({chartResolutionName:"30 seconds",chartResolutionValue:"30"})),this.get("chartResolutions").pushObject(Ember.Object.create({chartResolutionName:"45 seconds",chartResolutionValue:"45"})),this.get("chartResolutions").pushObject(Ember.Object.create({chartResolutionName:"1 minute",chartResolutionValue:"60"})),this.get("chartResolutions").pushObject(Ember.Object.create({chartResolutionName:"3 minutes",chartResolutionValue:"180"})),this.get("chartResolutions").pushObject(Ember.Object.create({chartResolutionName:"10 minutes",chartResolutionValue:"600"})),this.get("chartResolutions").pushObject(Ember.Object.create({chartResolutionName:"20 minutes",chartResolutionValue:"1200"})),this.get("chartResolutions").pushObject(Ember.Object.create({chartResolutionName:"40 minutes",chartResolutionValue:"2400"})),this.set("selectedChartResolution",this.get("chartResolutions").objectAt(0)),Montric.set("selectedTimezone",this.get("selectedTimezone.timezoneValue")),Montric.set("selectedChartTimespan",this.get("selectedChartTimespan.timespanValue")),Montric.set("selectedChartResolution",this.get("selectedChartResolution.chartResolutionValue")),Montric.set("selectedChartFromMs",this.get("selectedChartFrom").getTime()),Montric.set("showLiveCharts",this.get("showLiveCharts")),Montric.set("selectedChartToMs",this.get("selectedChartTo").getTime())},selectedTimezoneObserver:function(){console.log("selectedTimezoneObserver"),Montric.set("selectedTimezone",this.get("selectedTimezone.timezoneValue"))}.observes("selectedTimezone"),selectedChartTimespanObserver:function(){Montric.set("selectedChartTimespan",this.get("selectedChartTimespan.timespanValue"))}.observes("selectedChartTimespan"),selectedChartResolutionObserver:function(){Montric.set("selectedChartResolution",this.get("selectedChartResolution.chartResolutionValue"))}.observes("selectedChartResolution"),showLiveChartsObserver:function(){Montric.set("showLiveCharts",this.get("showLiveCharts"))}.observes("showLiveCharts"),selectedChartFromObserver:function(){Montric.set("selectedChartFromMs",this.get("selectedChartFrom").getTime())}.observes("selectedChartFrom"),selectedChartToObserver:function(){Montric.set("selectedChartToMs",this.get("selectedChartTo").getTime())}.observes("selectedChartTo"),historicalChartsSelected:function(){this.set("showLiveCharts",!1)},liveChartsSelected:function(){this.set("showLiveCharts",!0)},updateChartDates:function(){console.log("updateChartDates");var a=Date.fromString(this.get("selectedChartFromString")),b=Date.fromString(this.get("selectedChartToString"));null!==b&&1970!==b.getYear()?this.set("selectedChartTo",b):this.set("selectedChartFrom",new Date),null!==a&&1970!==a.getYear()?this.set("selectedChartFrom",a):(a=new Date(this.get("selectedChartFrom").getTime()-6e5),this.set("selectedChartFrom",a));var c=this.get("controllers.explore");console.log("chartsController"),console.log(c),c&&c.reloadCharts()},generateChartStrings:function(){this.set("selectedChartFromString",this.generateChartString(this.get("selectedChartFrom"))),this.set("selectedChartToString",this.generateChartString(this.get("selectedChartTo")))},generateChartString:function(a){var b=this.get("dateFormat")||"dd.mm.yy",c=a?dateFormat(a,b):"";return c},showModal:function(){console.log("showModal"),$("#chartOptionsModal").modal({show:!0})}}),Montric.LineChartComponent=Ember.Component.extend({classNames:["chart"],resizeHandler:null,nvd3Chart:null,resizeTimeout:null,serieObserver:function(){console.log("ChartView contentObserver!");var a=(this.get("elementId"),this.get("chart.series"));if(console.log("series: "+a),console.log(a),a){var b=new Rickshaw.Color.Palette({scheme:"munin"});a.forEach(function(a){a.color||(a.color=b.color())});var c=this;Ember.run.next(function(){c.rerender()});var d=this.get("resizeTimeout");$(window).resize(function(){clearTimeout(d),d=setTimeout(function(){console.log("RESIZING WINDOW"),Ember.run(function(){c.rerender()})},100),c.set("resizeTimeout",d)})}}.observes("chart.series","chart.series.length").on("init"),willDestroyElement:function(){$(window).off("resize");var a=this.get("resizeTimeout");console.log("CLEARING TIMEOUT! "+a),clearTimeout(a)},didInsertElement:function(){if(console.log("ChartView didInsertElement"),console.log(this.get("chart")),this.get("chart.series")){var a=this.get("chart.series"),b=this.get("elementId"),c=document.getElementById(b),d=document.createElement("div");d.id=b+"_chart",d.className="chart",c.appendChild(d);var e=document.createElement("div");e.id=b+"_legend_container",e.className="legend",d.appendChild(e);var f=document.createElement("div");f.id=b+"_legend_header",f.className="legend_header",f.innerHTML=this.get("chart.name"),e.appendChild(f);var g=document.createElement("div");g.id=b+"_legend",e.appendChild(g);var h=document.createElement("div");h.id=b+"_slider",c.appendChild(h);console.log("CONTROLLER: "+this.get("numCharts")+" : "+this.$().height()),console.log(this.$());var i=this.get("numCharts"),j=this.$().height()/i-2*i,k=this.$().width();console.log("height: "+j+" width: "+k),$("#"+b).css("height",j+"px"),$("#"+b).css("width",k+"px");var l=new Rickshaw.Graph({element:document.getElementById(b+"_chart"),width:k,height:j,renderer:"lineplot",series:a,min:0}),m=new Rickshaw.Graph.Legend({graph:l,element:document.getElementById(b+"_legend")}),n=Rickshaw.Class.create(Rickshaw.Graph.HoverDetail,{render:function(a){var c=this.graph,d=a.points,e=d.filter(function(a){return a.active}).shift();if(null!==e.value.y){var f='<span class="date">'+new Date(e.value.x).toUTCString()+"</span><br />";a.detail.sort(function(a,b){return a.order-b.order}).forEach(function(a){a.series.color||(a.series.color="#191990"),f+='<span class="detail_swatch" style="background-color: '+a.series.color+'"></span>',f+=a.name+": "+a.formattedYValue+"<br />"});{var g=e.formattedXValue;e.formattedYValue}this.element.innerHTML="",this.element.style.left=c.x(e.value.x)+"px";var h=document.createElement("div");h.className="x_label",h.innerHTML=g,this.element.appendChild(h);var i=document.createElement("div");i.id=b+"_hoverdiv",i.className="item";{var l=e.series;l.scale?l.scale.invert(e.value.y):e.value.y}i.innerHTML=f,i.style.top=this.graph.y(e.value.y0+e.value.y)+"px",this.element.appendChild(i);var m=document.createElement("div");m.className="dot",m.style.top=i.style.top,m.style.borderColor=l.color,this.element.appendChild(m),e.active&&(m.className="dot active"),this.show(),"function"==typeof this.onRender&&this.onRender(a);var n=this.graph.x(e.value.x)>k/2,o=this.graph.y(e.value.y)>j/2,p=$("#"+b+"_hoverdiv").outerWidth(),q=$("#"+b+"_hoverdiv").outerHeight();n&&o?(i.className="item rightitemBottom active",$("#"+b+"_hoverdiv").css({left:$("#"+b+"_hoverdiv").position().left-p-25+"px",top:$("#"+b+"_hoverdiv").position().top-q+25+"px"})):n&&!o?(i.className="item rightitem active",$("#"+b+"_hoverdiv").css({left:$("#"+b+"_hoverdiv").position().left-p-25+"px"})):!n&&o?(i.className="item leftitemBottom active",$("#"+b+"_hoverdiv").css({top:$("#"+b+"_hoverdiv").position().top-q+25+"px"})):n||o||(i.className="item leftitem active")}}}),o=(new n({graph:l}),new Rickshaw.Graph.Behavior.Series.Toggle({graph:l,legend:m}),new Rickshaw.Graph.Behavior.Series.Highlight({graph:l}),new Rickshaw.Graph.Axis.X({graph:l,ticks:9,tickFormat:function(a){return dateFormat(a,"dd/mm HH:MM:ss")}})),p=new Rickshaw.Graph.Axis.Y({graph:l,tickFormat:Rickshaw.Fixtures.Number.formatKMBT});p.render(),o.render(),l.render()}}}),Montric.MultiSelectableListItemComponent=Ember.Component.extend({classNameBindings:["active"],click:function(){console.log("CLICK: "+this.get("node"));var a=this.get("isSelected"),b=this.get("selectedNodes"),c=this.get("node.id");c||(c=this.get("node")),a?b.removeObject(c):(console.log("pushing object: "+c),b.pushObject(c))},isSelected:function(){var a=!1,b=this.get("node.id");b||(b=this.get("node"));var c=this.get("selectedNodes");return c.forEach(function(c){c===b&&(a=!0)}),a}.property("node.id","selectedNodes.length"),active:function(){var a=!1,b=this.get("node.id");return b||(b=this.get("node")),this.get("selectedNodes")&&this.get("selectedNodes").forEach(function(c){c===b&&(a=!0)}),a}.property("selectedNodes.length","node.id")}),Montric.SingleSelectableListItemComponent=Ember.Component.extend({classNameBindings:["active"],click:function(){console.log("CLICK: "+this.get("node")),this.get("isSelected")?this.set("selectedNode",null):this.set("selectedNode",this.get("node"))},isSelected:function(){var a=this.get("node.id");a||(a=this.get("node"));var b=this.get("selectedNode");return b&&b.get("id")===a}.property("node.id","selectedNode.id")}),Montric.TreeMenuComponent=Ember.Component.extend({classNames:["selectableList"],actions:{selectNode:function(a){console.log("TreeMenuComponent node: "+a),this.set("selectedNode",a.get("id"))}}}),Montric.TreeMenuNodeComponent=Ember.Component.extend({classNames:["pointer"],actions:{toggleExpanded:function(){this.toggleProperty("node.isExpanded")},toggleSelected:function(){this.toggleProperty("node.isSelected")},selectNode:function(a){console.log("selectedNode: "+a),this.sendAction("action",a)}},isSelected:function(){return console.log("'"+this.get("selectedNode")+"' :: '"+this.get("node.id")+"'"),this.get("selectedNode")===this.get("node.id")}.property("selectedNode","node.id"),showNode:function(){var a=!0,b=this.get("excludeGeneratedNodes");return b&&"generated"===this.get("node.nodeType")&&(a=!1),a}.property("excludeGeneratedNodes","node.nodeType")}),Montric.ExploreController=Ember.ArrayController.extend({needs:["application"],allowMultipleSelections:!0,contentIsLoadedObserver:function(){console.log("Metrics isLoaded: "+this.get("content.isLoaded"));var a=Ember.A();this.get("content.isLoaded")&&(console.log("Starting iteration over menu nodes"),this.get("content").forEach(function(b){b.get("parent.id")||a.pushObject(b)}),a.sort(Montric.Metric.compareNodes),console.log("Finished iterating over menu nodes. found "+a.get("length")+" root nodes")),this.set("rootNodes",a)}.observes("content.isLoaded").on("init"),isSelectedObserver:function(){if(this.get("content")){var a=this.get("content").filter(function(a){return a.get("isSelected")?(console.log(a),console.log(a.get("chart")),!0):void 0});this.set("selectedNodes",a)}}.observes("content.@each.isSelected"),selectedNodesObserver:function(){if(this.get("selectedNodes.length")){var a=this.get("selectedNodes.length"),b=this.get("controllers.application").get("showLiveCharts");a>0&&null===this.get("chartTimerId")?this.startTimer():0!==a&&b||this.stopTimer()}else this.stopTimer()}.observes("selectedNodes.length"),startTimer:function(){console.log("Startig timer...");var a=this,b=setInterval(function(){Ember.run(function(){a.get("controllers.application").get("showLiveCharts")&&a.reloadCharts()})},15e3);this.set("chartTimerId",b)},stopTimer:function(){console.log("Stopping timer..."),null!==this.get("chartTimerId")&&(console.log("stopping timer"),clearInterval(this.get("chartTimerId")),this.set("chartTimerId",null))},reloadCharts:function(){var a=this;this.get("selectedNodes").forEach(function(b){a.reloadChart(b.get("chart"))})},reloadChart:function(a){a&&!a.get("isDirty")&&a.get("isLoaded")&&a.get("content")&&(console.log("Reloading: "),console.log(a),a.get("content").reload())}}),Montric.ExploreRoute=Ember.Route.extend({model:function(){return this.store.find("metric")}}),Montric.HeaderController=Ember.Controller.extend({actions:{doLogOut:function(){navigator.id.logout()}}}),Montric.IndexRoute=Ember.Route.extend({beforeModel:function(){this.transitionTo("login")}}),Montric.LoginController=Ember.Controller.extend({needs:["user"],currMoment:moment(),init:function(){this._super();var a=this,b=setInterval(function(){Ember.run.later(function(){console.log("Updating Moment..."),a.set("currMoment",moment())})},3e4);this.set("momentInterval",b)},currentDate:function(){return this.get("currMoment").format("ll")}.property("currMoment"),currentTime:function(){return this.get("currMoment").format("HH:mm a")}.property("currMoment"),isLoggedIn:function(){return this.get("controllers.user.isLoggedIn")}.property("controllers.user.isLoggedIn"),isLoggingIn:function(){return this.get("controllers.user.isLoggingIn")}.property("controllers.user.isLoggingIn")}),Montric.LoginRoute=Ember.Route.extend({actions:{doLogin:function(){console.log("logging in!"),navigator.id.request()},doLogout:function(){navigator.id.logout()}}}),Montric.AccessToken=DS.Model.extend({accountName:DS.attr("string"),accessTokenName:DS.attr("string")}),Montric.Account=DS.Model.extend({accountType:DS.attr("string"),accessTokens:DS.attr("raw")}),Montric.AdminMenu=DS.Model.extend({name:DS.attr("string"),nodeType:DS.attr("string"),parent:DS.belongsTo("adminMenu"),children:DS.hasMany("adminMenu"),isSelected:!1,isExpanded:!1,hasChildren:function(){return this.get("children").get("length")>0}.property("children").cacheable(),isLeaf:function(){return 0===this.get("children").get("length")}.property("children").cacheable(),isAlert:function(){return"alert"===this.get("nodeType")}.property("nodeType"),isExpandedObserver:function(){if(console.log("isExpanded: "+this.get("id")),this.get("isExpanded")){var a=this.get("children.content");a&&(console.log("Sorting children"),a.sort(Montric.AdminMenu.compareNodes))}}.observes("isExpanded")}),Montric.AdminMenu.reopenClass({compareNodes:function(a,b){return a.get("id")>b.get("id")?1:a.get("id")<b.get("id")?-1:0}}),Montric.Alert=DS.Model.extend({alertActivated:DS.attr("boolean"),alertSource:DS.attr("string"),alertNotifications:DS.attr("raw"),alertWarningValue:DS.attr("number"),alertErrorValue:DS.attr("number"),alertType:DS.attr("string"),alertDelay:DS.attr("number")}),Montric.AlertPlugin=DS.Model.extend({}),Montric.AlertRecipient=DS.Model.extend({accountName:DS.attr("string"),pluginName:DS.belongsTo("alertPlugin",{async:!0}),recipients:DS.attr("raw"),selectedRecipients:[]}),Montric.ChartGroup=DS.Model.extend({chartGroups:DS.hasMany("metric"),selectedChartGroups:[]}),Montric.Chart=DS.Model.extend({name:DS.attr("string"),series:DS.attr("raw")}),Montric.MainMenu=DS.Model.extend({name:DS.attr("string"),nodeType:DS.attr("string"),parent:DS.belongsTo("mainMenu"),children:DS.hasMany("mainMenu"),chart:DS.belongsTo("chart"),isSelected:!1,isExpanded:!1,isSelectedAdmin:!1,isExpandedAdmin:!1,hasChildren:function(){return this.get("children").get("length")>0}.property("children"),isLeaf:function(){return 0===this.get("children").get("length")}.property("children"),isAlert:function(){return"alert"===this.get("nodeType")}.property("nodeType"),isExpandedObserver:function(){if(console.log("isExpanded: "+this.get("id")),this.get("isExpanded")){var a=this.get("children.content");a&&(console.log("Sorting children"),a.sort(Montric.MainMenu.compareNodes))}}.observes("isExpanded")}),Montric.MainMenu.reopenClass({compareNodes:function(a,b){return a.get("id")>b.get("id")?1:a.get("id")<b.get("id")?-1:0}}),Montric.User=DS.Model.extend({userName:DS.attr("string"),accountName:DS.attr("string"),userRole:DS.attr("string"),firstname:DS.attr("string"),lastname:DS.attr("string"),company:DS.attr("string"),country:DS.attr("string"),usage:DS.attr("string"),isNew:function(){return"new"===this.get("userRole")}.property("userRole"),isUser:function(){return"user"===this.get("userRole")||"beta"===this.get("userRole")||this.get("isAdmin")||this.get("isRoot")}.property("userRole"),isAdmin:function(){return"admin"===this.get("userRole")||this.get("isRoot")}.property("userRole"),isRoot:function(){return"root"===this.get("userRole")}.property("userRole"),isUnregistered:function(){return"notRegistered"===this.get("userRole")}.property("userRole"),isNotAuthenticated:function(){return!(this.get("isUser")||this.get("isUnregistered"))}.property("userRole")}),Montric.Metric=DS.Model.extend({nodeType:DS.attr("string"),parent:DS.belongsTo("metric",{inverse:"children",async:"true"}),children:DS.hasMany("metric",{inverse:"parent"}),chart:DS.belongsTo("chart",{async:!0}),name:function(){var a=this.get("id"),b=this.get("id");return b&&b.indexOf(":")>0&&(a=b.substr(b.lastIndexOf(":")+1,b.length)),a}.property("id"),isSelected:!1,isExpanded:!1,isSelectedAdmin:!1,isExpandedAdmin:!1,hasChildren:function(){return this.get("children").get("length")>0}.property("children").cacheable(),isLeaf:function(){return 0===this.get("children").get("length")}.property("children").cacheable(),isAlert:function(){return"alert"===this.get("nodeType")}.property("nodeType")}),Montric.Metric.reopenClass({compareNodes:function(a,b){return a.get("id")>b.get("id")?1:a.get("id")<b.get("id")?-1:0}}),Montric.RegisterController=Ember.Controller.extend({needs:["user"],newAccountName:null,newFirstName:null,newSurname:null,newCompanyName:null,newCountry:null,newUsage:null,errorMessage:null,accountNameIsUnique:!1,actions:{registerAccount:function(){console.log("testing error message"),this.validateNewAccount(),this.set("errorMessage","Registration was not sucessful. Please try again!")},accountFocusOut:function(){console.log("accountFocusOut!!");var a=this.get("newAccountName"),b=this;a&&$.ajax({type:"GET",url:"/verifyAccountName/account/"+a,success:function(a){a&&a.isUnique===!0?(b.set("errorMessage","Unique account name. Please continue..."),b.set("accountNameIsUnique",!0)):(b.set("errorMessage","That account name is already taken. Please choose another one."),b.set("accountNameIsUnique",!1))},error:function(){b.set("errorMessage","Unable to verify unique account name. Please try again later. ")}})}},validateNewAccount:function(){var a=this.get("newAccountName"),b=this.get("accountNameIsUnique"),c=this.get("controllers.user.content.userName"),d=this;if(b&&c){var e={user:{id:c,accountName:a,firstname:this.get("newFirstName"),lastname:this.get("newSurname"),company:this.get("newCompanyName"),country:this.get("newCountry"),usage:this.get("newUsage")}};$.ajax({type:"POST",url:"/user/auth/register",contentType:"application/json",data:JSON.stringify(e),success:function(a){a&&a.registered===!0&&null!==a.uuidToken&&d.get("controllers.user").reloadUser()},error:function(){}}),this.transitionToRoute("login")}else this.set("Please complete the registration from in order to register a new account")},isErrorMessageShown:function(){return null!==this.get("errorMessage")}.property("errorMessage")}),Montric.Router=Ember.Router.extend({location:"history"}),Montric.Router.map(function(){this.route("login"),this.route("register"),this.resource("main",{path:"/main"},function(){this.resource("dashboards",{path:"/dashboards"},function(){}),this.resource("explore",{path:"/explore"},function(){}),this.resource("admin",{path:"/admin"},function(){this.route("alerts",{path:"/alerts"},function(){this.route("alert",{path:"/:alert_id"})}),this.route("chartGroups",{path:"/chartGroups"},function(){this.route("chartGroup",{path:"/:chart_group_id"})}),this.route("alertRecipients",{path:"/alertRecipients"},function(){this.route("alertRecipient",{path:"/:alert_recipient_id"})}),this.route("accessTokens",{path:"/accessTokens"},function(){this.route("accessToken",{path:"/:access_token_id"})}),this.route("users"),this.route("accounts")})})}),Montric.ChartAdapter=DS.RESTAdapter.extend({find:function(a,b,c){return console.log("Montric.ChartAdapter find: "+c),this.ajax(this.buildURL(b.typeKey,c),"GET")},buildURL:function(a,b){var c=Ember.get(this,"host"),d=Ember.get(this,"namespace"),e=[];c&&e.push(c),d&&e.push(d),e.push(Ember.String.pluralize(a)),b&&e.push(b),e=e.join("/"),c||(e="/"+e);var f=this.buildQueryString();return e+f},buildQueryString:function(){var a="?tz="+Montric.get("selectedTimezone");return Montric.get("showLiveCharts")?a+="&ts="+Montric.get("selectedChartTimespan"):(a+="&chartFrom="+Montric.get("selectedChartFromMs"),a+="&chartTo="+Montric.get("selectedChartToMs")),a+="&rs="+Montric.get("selectedChartResolution")}}),Montric.MetricSerializer=DS.RESTSerializer.extend({normalizePayload:function(a){return console.log("NORMALIZING PAYLOAD"),a=this._super(a),a.metrics&&a.metrics.forEach(function(a){a.chart=a.id}),a},extractArray:function(a,b,c){console.log("EXTRACT ARRAY");var d=c.metrics;metricCache={};var e="Alerts",f="Chart Groups";metricCache[e]={id:e,name:"Alerts",parent:null,children:[],nodeType:"generated"},metricCache[f]={id:f,name:"Chart Groups",parent:null,children:[],nodeType:"generated"},console.log("metrics before: "+d.get("length")),d.forEach(function(a){if(a.id&&"null"!==a.id)if(a.nodeType&&"alert"===a.nodeType)metricCache[e].children.pushObject(a.id),a.parent=e,metricCache[a.id]=a;
else if(a.nodeType&&"grouped_statistics"===a.nodeType)metricCache[f].children.pushObject(a.id),a.parent=f,metricCache[a.id]=a;else if(a.nodeType&&"chart"===a.nodeType){metricCache[a.id]=a;for(var b=a.id;b.indexOf(":")>0;){var c=b.substr(0,b.lastIndexOf(":")),d=metricCache[c];d&&d.id||(d={id:c,children:[b],parent:null},metricCache[c]=d),d.children||(d.children=[]),d.children.contains(b)||d.children.pushObject(b);var g=metricCache[b];g?g.parent=c:(g={id:b,children:[],parent:c},metricCache[b]=g),b=c}}});var g=[];for(var h in metricCache)g.pushObject(metricCache[h]);return console.log("metrics after: "+g.get("length")),c={metrics:g},this._super(a,b,c)}}),Montric.RawTransform=DS.Transform.extend({deserialize:function(a){return a},serialize:function(a){return a}}),Montric.SettingsController=Ember.Controller.extend({}),Montric.ApplicationStore=DS.Store.extend({adapter:"Montric.Adapter"}),Montric.UserController=Ember.Controller.extend({needs:["application"],init:function(){var a=this,b=Montric.readCookie("uuidToken");b&&this.set("uuidToken",b),navigator.id.watch({onlogin:function(b){a.set("isLoggingIn",!0),$.ajax({type:"POST",url:"/user/auth/login",data:{assertion:b},success:function(b){console.log(b),b.uuidToken&&Montric.createCookie("uuidToken",b.uuidToken,1),b.registered===!0?(console.log("user authenticated. Setting UUID Token"),a.set("uuidToken",b.uuidToken),a.set("isLoggingIn",!1)):(console.log("onLogin success. Not Registered"),a.set("newUuidToken",b.uuidToken),a.transitionToRoute("register"))},error:function(a,b,c){console.log("error: "+b+" error: "+c)}})},onlogout:function(){a.set("content",null),a.set("uuidToken",null),Montric.eraseCookie("uuidToken")}})},uuidTokenObserver:function(){if(this.get("uuidToken")){var a=this;this.store.find("user",this.get("uuidToken")).then(function(b){a.set("content",b)})}else this.set("content",null),this.transitionToRoute("login")}.observes("uuidToken").on("init"),reloadUser:function(){this.set("content",this.get("content").reload())},isLoggedIn:function(){return void 0!==this.get("content.id")&&null!==this.get("content.id")}.property("content.id"),userRoleObserver:function(){this.get("content.isNotAuthenticated")?(console.log("user is not authenticated in Montric. Transitioning to Login"),this.transitionToRoute("login")):this.get("content.isNew")?this.transitionToRoute("login.activation"):this.get("content.isUnregistered")?(console.log("user is not registered in Montric. Transitioning to Registration"),console.log(this),this.transitionToRoute("register")):this.get("content.isUser")&&(console.log("user is logged in and is a user: "+this.get("content.isUser")+" :: "+this.get("content")),("login"===this.get("controllers.application.currentPath")||"register"===this.get("controllers.application.currentPath"))&&(console.log("redirecting to dashboards"),this.transitionToRoute("dashboards")))}.observes("content.userRole")}),"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.slice(-a.length)===a});